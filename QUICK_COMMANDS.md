# IPv4 Detection - Quick Command Reference\n\n## One-Liner Commands\n\n### Linux/macOS\n```bash\npython3 agent/monitor-agent.py --token abc123def456 --device \"SmartMeter-Lab\" --server http://localhost:3000\n```\n\n### Windows PowerShell\n```powershell\npython agent/monitor-agent.py --token abc123def456 --device \"SmartMeter-Lab\" --server http://localhost:3000\n```\n\n## Common Scenarios\n\n### Scenario 1: Local Development\n```bash\n# Terminal 1: Start dashboard\ncd /path/to/monitor-app\nnpm run dev\n\n# Terminal 2: Run agent\ncd agent\npython3 monitor-agent.py --token YOUR_TOKEN --device \"TestDevice\"\n\n# Result: See \"Local IPv4: ...\" in agent output\n# Visit: http://localhost:3000 → View IPv4 in table\n```\n\n### Scenario 2: Remote Server Monitoring\n```bash\n# Get token from dashboard first\n# Then run:\npython3 agent/monitor-agent.py \\\n  --token YOUR_AUTH_TOKEN \\\n  --device \"Production-Meter-01\" \\\n  --server http://192.168.1.100:3000 \\\n  --interval 5\n\n# Shows local IPv4 addresses on that server\n```\n\n### Scenario 3: Multiple Devices\n```bash\n# Device 1\ndevice1$ python3 monitor-agent.py --token token1 --device \"Device-1\"\n\n# Device 2  \ndevice2$ python3 monitor-agent.py --token token2 --device \"Device-2\"\n\n# Device 3\ndevice3$ python3 monitor-agent.py --token token3 --device \"Device-3\"\n\n# Dashboard shows all IPv4 addresses from all devices\n```\n\n### Scenario 4: Using Environment Variables\n```bash\nexport MONITOR_AUTH_TOKEN=\"your_token_here\"\nexport MONITOR_DEVICE_NAME=\"SmartMeter-01\"\nexport MONITOR_SERVER_URL=\"http://localhost:3000\"\nexport MONITOR_REFRESH_INTERVAL=\"10\"\n\npython3 agent/monitor-agent.py\n```\n\n### Scenario 5: Background Mode (Unix/Linux)\n```bash\n# Run in background with nohup\nnohup python3 agent/monitor-agent.py --token YOUR_TOKEN --device \"Device\" > agent.log 2>&1 &\n\n# Or with screen\nscreen -S monitor\npython3 agent/monitor-agent.py --token YOUR_TOKEN --device \"Device\"\n# Press Ctrl+A then D to detach\n\n# Or with systemd\n# Create /etc/systemd/system/monitor-agent.service\n[Unit]\nDescription=Smart Meter Monitor Agent\nAfter=network.target\n\n[Service]\nType=simple\nUser=meter\nWorkingDirectory=/opt/monitor-app/agent\nExecStart=/usr/bin/python3 monitor-agent.py --token YOUR_TOKEN\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n\n# Then:\nsudo systemctl enable monitor-agent\nsudo systemctl start monitor-agent\nsudo systemctl status monitor-agent\n```\n\n## Expected Output\n\n### On Startup (IPv4 Detection)\n```\n[*] Starting network monitoring...\n    Server: http://localhost:3000\n    Device: SmartMeter-Lab\n    OS: Linux\n    Refresh interval: 10s\n    Local IPv4: 192.168.1.45, 172.17.0.2\n\n```\n\n### During Monitoring\n```\n[14:23:45] Cycle 1: Scanning connections... Found 24 new connections\n    [24] connections reported to server\n[14:23:55] Cycle 2: Scanning connections... Found 5 new connections\n    [5] connections reported to server\n```\n\n## Dashboard Verification\n\n### Direct URL\n```\nhttp://localhost:3000/dashboard\n```\n\n### Table Columns (with IPv4)\n```\nDevice Name | Username | Status | Connections | Protocols | IPv4 Addr | IPv6 Addr | Last Seen | Action\n```\n\n### View IPv4 for Device\n1. Open http://localhost:3000\n2. Login with credentials\n3. Look for \"IPv4 Addresses\" column\n4. Blue badges = IPv4 addresses\n5. Purple badges = IPv6 addresses\n\n## API Direct Check\n\n### Get all devices and their IPv4\n```bash\ncurl -H \"Authorization: Bearer YOUR_TOKEN\" \\\n     http://localhost:3000/api/dashboard/users | jq '.data[] | {deviceName, ipv4Addresses, ipv6Addresses}'\n```\n\n### Output\n```json\n{\n  \"deviceName\": \"SmartMeter-01\",\n  \"ipv4Addresses\": [\n    \"192.168.1.100\",\n    \"10.0.0.50\"\n  ],\n  \"ipv6Addresses\": [\n    \"fe80::1\",\n    \"2001:db8::1\"\n  ]\n}\n```\n\n## Troubleshooting Commands\n\n### Check if Agent is Running\n```bash\n# Linux/macOS\nps aux | grep monitor-agent.py\n\n# Windows PowerShell\nGet-Process python | Where-Object {$_.CommandLine -like \"*monitor-agent*\"}\n```\n\n### Check Local IPv4 Manually\n\n**Linux**\n```bash\nhostname -I\n# Output: 192.168.1.100 172.17.0.2\n```\n\n**macOS**\n```bash\nifconfig | grep \"inet \"\n# Output: inet 192.168.1.100 netmask 0xffffff00 broadcast 192.168.1.255\n```\n\n**Windows (PowerShell)**\n```powershell\nipconfig | Select-String \"IPv4 Address\"\n# Output: IPv4 Address. . . . . . . . . . . . : 192.168.1.100\n```\n\n### Test Server Connection\n```bash\ncurl -v http://localhost:3000\n\n# Success: HTTP/1.1 200 OK\n# Failure: Connection refused\n```\n\n### Check Agent Logs\n```bash\n# If running with nohup\ntail -f agent.log\n\n# If running with screen\nscreen -r monitor\n\n# If running with systemd\njournalctl -u monitor-agent -f\n```\n\n## Performance Check\n\n### Agent Resource Usage\n```bash\n# Monitor CPU and memory\n# Linux\nwatch -n 1 'ps aux | grep [m]onitor-agent.py'\n\n# macOS\ntop -p $(pgrep -f \"monitor-agent.py\")\n\n# Windows PowerShell\nGet-Process python | Select-Object Name, CPU, Memory | Format-List\n```\n\n## Token Management\n\n### Generate New Token (if needed)\n```bash\ncd agent\npython3 generate_token.py\n```\n\n### Extract Token by Device\n```bash\ncurl -H \"Authorization: Bearer ADMIN_TOKEN\" \\\n     http://localhost:3000/api/auth/generate-token\n```\n\n## Complete Setup Script\n\n```bash\n#!/bin/bash\n# setup-and-run.sh\n\nset -e\n\necho \"[1] Starting dashboard...\"\nnpm run dev &\nDASHBOARD_PID=$!\n\necho \"[2] Waiting for dashboard to start...\"\nsleep 3\n\necho \"[3] Generating token...\"\nTOKEN=$(cd agent && python3 generate_token.py | grep \"Token:\" | cut -d':' -f2 | xargs)\n\necho \"[4] Starting agent with IPv4 detection...\"\necho \"Token: $TOKEN\"\ncd agent\npython3 monitor-agent.py --token \"$TOKEN\" --device \"$(hostname)\"\n\n# Cleanup on exit\ntrap \"kill $DASHBOARD_PID\" EXIT\n```\n\n## One-Command Full Setup\n\n```bash\n# All-in-one for testing\nnpm run dev & sleep 3 && cd agent && python3 monitor-agent.py --token test123 --device LocalTest\n```\n\n## Platform-Specific Notes\n\n### Linux IPv4 Detection\n```bash\n# Detected using:\nhostname -I\n\n# Alternative if hostname -I not available:\nip addr show | grep \"inet \"\n```\n\n### macOS IPv4 Detection  \n```bash\n# Detected using:\nifconfig\n\n# Parses lines with:\ninet 192.168.1.100\n```\n\n### Windows IPv4 Detection\n```powershell\n# Detected using:\nipconfig\n\n# Parses lines with:\nIPv4 Address . . . . . . . . . . . . : 192.168.1.100\n```\n\n## Success Indicators\n\n✓ Agent shows: \"Local IPv4: 192.168.x.x\"\n✓ Dashboard has \"IPv4 Addresses\" column\n✓ API returns ipv4Addresses array\n✓ Blue badges appear in device table\n✓ \"View Details\" shows full IPv4 list\n"